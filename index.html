<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SMARMELLATA 2025 - Regalo Natalizio</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/environments/RoomEnvironment.js"></script>

    <style>
        /* --- STILI PRELOADER (AGGIUNTI) --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0a0a0a;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s cubic-bezier(0.65, 0, 0.35, 1), visibility 0.8s;
        }
        #preloader.finished {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .loader-content { text-align: center; width: 250px; }
        .loader-logo { width: 80px; margin-bottom: 30px; animation: pulse 2s infinite ease-in-out; }
        .progress-wrapper { width: 100%; height: 2px; background: rgba(255, 255, 255, 0.1); margin-bottom: 15px; overflow: hidden; }
        #loader-bar { width: 0%; height: 100%; background: #ffffff; transition: width 0.3s ease; }
        #loader-text { font-family: 'Inter Tight', sans-serif; font-size: 0.7rem; letter-spacing: 2px; color: rgba(255, 255, 255, 0.5); text-transform: uppercase; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

        /* --- TUO STILE ORIGINALE (INVARIATO) --- */
        @font-face {
            font-family: 'AnalogueOS';
            src: url('assets/AnalogueOS-Regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            overscroll-behavior: none; 
        }
        
        body {
            background-color: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
            height: 100%;
            font-family: 'Inter Tight', sans-serif;
            font-weight: 400;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }
        
        .main-container {
            position: relative;
            height: 100vh;      
            height: 100dvh;     
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        
        .fullscreen-section {
            height: 100vh;      
            height: 100dvh;     
            width: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always; 
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .section-content {
            max-width: 1200px;
            width: 90%;
            padding: 40px;
            position: relative;
            z-index: 2;
            opacity: 0;
            visibility: hidden;
        }
        
        .section-content.visible {
            opacity: 1;
            visibility: visible;
        }
        
        #section1 {
            background: url('assets/IMG/SFONDO/sfondo5.webp');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        #section1::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        
        .hero-title {
            position: relative;
            z-index: 10;
            text-align: center;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s 0.5s forwards;
            display: inline-block; 
        }
        
        .main-title {
            font-family: 'AnalogueOS', sans-serif;
            display: block;
            font-size: 8.5rem;
            line-height: 1;
            margin-top: -60px;
            position: relative;
        }
        
        .hero-subtitle {
            font-family: 'AnalogueOS', sans-serif;
            font-size: 2.8rem;
            color: #e0e0e0; 
            text-align: center;
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 800px;
            opacity: 0;
            animation: fadeInUp 1s 1s forwards;
        }
        
        .year-badge {
            position: absolute;
            top: -20px;
            right: -60px;
            display: inline-block;
            background-color: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            padding: 5px 15px;
            border-radius: 20px;
            font-family: 'Inter Tight', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            z-index: 10;
            transform: rotate(10deg);
        }
        
        #model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
            opacity: 1; 
        }
        
        #section2 {
            background: linear-gradient(135deg, rgb(30, 30, 30) 0%, rgba(10, 10, 10, 1) 100%);
        }
        
        #section3 {
            background-color: #111;
            position: relative;
            cursor: default;
        }

        #oranges-canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .oranges-overlay-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.2);
            font-family: 'AnalogueOS', sans-serif;
            font-size: 2rem;
            font-weight: bold;
            pointer-events: none;
            text-transform: uppercase;
            letter-spacing: 4px;
            z-index: 10;
            text-align: center;
            width: 50%;
            user-select: none;
        }

        .gyro-button {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 25px;
            background: rgba(20, 20, 20, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            color: white;
            font-family: 'Inter Tight', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            z-index: 20;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .gyro-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-50%) scale(1.05);
        }

        .gyro-button.active {
            background: #ffffff;
            color: #000;
            border-color: #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        .section-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 40%);
            z-index: 1;
        }
        
        .section-title {
            font-family: 'AnalogueOS', sans-serif;
            font-size: 4.5rem;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            background-color: transparent;
            padding: 12px 10px 0px 0px;
            gap: 10px;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s 0.3s forwards;
            letter-spacing: 1px;
            line-height: 1.1;
            color: #ffffff;
            padding-left: 20px;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .nav-indicator {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .nav-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-dot.active {
            background-color: #ffffff;
            transform: scale(1.4);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            border: none;
        }
        
        .nav-dot:hover {
            transform: scale(1.3);
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        .nav-label {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            font-weight: 500;
            font-family: 'Inter Tight', sans-serif;
        }
        
        .nav-dot:hover .nav-label { opacity: 1; }
        
        .logo-fixed {
            position: fixed;
            top: 40px;
            left: 40px;
            z-index: 1000;
            width: 100px;
            height: auto;
            opacity: 0;
            animation: fadeIn 1s 0.2s forwards;
            transition: transform 0.3s ease;
        }
        
        .logo-fixed:hover { transform: scale(1.05); }
        .logo-img { width: 100%; height: auto; filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)); }
        
        .scroll-arrow {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 2rem;
            z-index: 10;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
            animation: bounce 2s infinite;
        }
        
        .scroll-arrow:hover { opacity: 1; transform: translateX(-50%) scale(1.1); color: #fff; }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }
        
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.05);
            z-index: 1000;
        }
        
        .scroll-progress-bar {
            height: 100%;
            background: #ffffff;
            width: 0%;
            transition: width 0.1s ease;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .hero-content {
            position: relative;
            z-index: 10;
            text-align: center;
            width: 100%;
            height: 80%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-top: 60px;
        }
        
        .model-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255,255,255,0.5);
            font-size: 1.2rem;
            z-index: 2;
            font-family: 'Inter Tight', sans-serif;
        }
        
        .categories-section {
            margin-top: 50px;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s 0.7s forwards;
            width: 100%;
        }
        
        .categories-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap; 
            padding-bottom: 10px;
        }
        
        .category-tab {
            padding: 10px 25px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter Tight', sans-serif;
            white-space: nowrap;
            border-radius: 4px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .category-tab:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .category-tab.active {
            background-color: #ffffff;
            color: #000000;
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        
        .desktop-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 20px;
            min-height: 400px;
        }
        
        .mobile-cards-container {
            display: none;
            position: relative;
            width: 100%;
            margin-top: 20px;
            min-height: 350px;
            overflow: hidden; 
        }
        
        @keyframes cardEntrance {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .desktop-card {
            background-color: rgba(20, 20, 20, 0.6);
            border-radius: 2px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.4s cubic-bezier(0.215, 0.61, 0.355, 1), box-shadow 0.4s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            min-height: 400px;
            position: relative;
            opacity: 0;
            animation: cardEntrance 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        .desktop-card:hover {
            transform: translateY(-8px);
            background-color: rgba(40, 40, 40, 0.8);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .mobile-card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(20, 20, 20, 0.6);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.5s cubic-bezier(0.215, 0.61, 0.355, 1), opacity 0.5s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateX(100%);
        }
        
        .mobile-card.active { opacity: 1; transform: translateX(0); z-index: 2; }
        .mobile-card.previous { opacity: 0; transform: translateX(-100%); z-index: 1; }
        .mobile-card.next { opacity: 0; transform: translateX(100%); z-index: 1; }
        
        @keyframes mobileContentEntrance {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .mobile-card.active.entrance-anim {
            animation: mobileContentEntrance 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .card-image {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            filter: none; 
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }
        
        .desktop-card:hover .card-image img,
        .mobile-card:hover .card-image img { transform: scale(1.1); }
        
        .card-content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 30px;
            z-index: 3;
            display: flex;
            align-items: end;
            justify-content: center;
            min-height: 150px;
            background: none; 
        }

        .card-content::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            background: rgba(0, 0, 0, 0.2);
            mask-image: linear-gradient(to top, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%);
            -webkit-mask-image: linear-gradient(to top, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%);
            z-index: -1;
            pointer-events: none;
        }
        
        .card-title {
            font-family: 'AnalogueOS', sans-serif;
            font-size: 2rem;
            color: #ffffff;
            text-align: center;
            font-weight: 600;
            letter-spacing: 1px;
            background-color: rgba(36, 36, 36, 1);
            padding: 10px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative; 
            z-index: 2;
        }
        
        .mobile-nav-buttons {
            position: absolute;
            top: 50%; 
            bottom: auto; 
            left: 0;
            right: 0;
            height: auto; 
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            align-items: center; 
            padding: 0 10px;
            z-index: 20; 
            pointer-events: none; 
        }
        
        .mobile-nav-button {
            pointer-events: auto;
            width: 40px;
            height: 40px;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .mobile-nav-button:hover {
            background: rgba(255, 255, 255, 1);
            color: #000;
            transform: scale(1.1);
        }
        
        .cards-dots {
            display: none; 
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            z-index: 5;
        }
        
        .card-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .card-dot.active {
            background-color: #ffffff;
            transform: scale(1.2);
        }
        
        .recipe-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.4s ease, background-color 0.4s ease;
            pointer-events: none;
        }
        
        .recipe-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            background-color: rgba(0, 0, 0, 0.85);
            pointer-events: auto;
            backdrop-filter: blur(5px);
        }
        
        .recipe-modal-content {
            background: #121212;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 2px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transform: scale(0.95) translateY(20px);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1), opacity 0.4s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
        }

        @media(min-width: 768px) {
            .recipe-modal-content {
                flex-direction: row;
                height: 600px;
            }
        }
        
        .recipe-modal.active .recipe-modal-content { transform: scale(1) translateY(0); opacity: 1; }
        
        .recipe-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .recipe-modal-close:hover { background-color: #ffffff; color: #000; transform: rotate(90deg); }
        
        .recipe-modal-image {
            width: 100%;
            height: 250px;
            overflow: hidden;
            position: relative;
        }

        @media(min-width: 768px) {
            .recipe-modal-image {
                width: 45%;
                height: 100%;
            }
        }
        
        .recipe-modal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .recipe-modal-body {
            padding: 40px;
            overflow-y: auto;
            flex: 1;
            background: linear-gradient(180deg, #121212 0%, #1a1a1a 100%);
        }
        
        .recipe-modal-title {
            font-family: 'AnalogueOS', sans-serif;
            font-size: 2.8rem;
            margin-bottom: 25px;
            color: #ffffff;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease 0.2s, transform 0.5s ease 0.2s;
            line-height: 1;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
        }
        
        .recipe-modal.active .recipe-modal-title { opacity: 1; transform: translateY(0); }

        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease 0.25s, transform 0.5s ease 0.25s;
        }

        .recipe-modal.active .recipe-meta { opacity: 1; transform: translateY(0); }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #aeaeae;
            font-size: 0.95rem;
            font-family: 'Inter Tight', sans-serif;
        }

        .meta-item i {
            color: #ffffff;
            font-size: 1rem;
        }

        .meta-value {
            color: #ffffff;
            font-weight: 500;
        }
        
        .recipe-modal-ingredients, .recipe-modal-instructions {
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .recipe-modal.active .recipe-modal-ingredients { opacity: 1; transform: translateY(0); transition-delay: 0.3s; }
        .recipe-modal.active .recipe-modal-instructions { opacity: 1; transform: translateY(0); transition-delay: 0.4s; }
        
        .recipe-modal-ingredients h3, .recipe-modal-instructions h3 {
            font-family: 'Inter Tight', sans-serif;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            color: #aeaeae;
            font-weight: 600;
        }
        
        .recipe-modal-ingredients ul, .recipe-modal-instructions ol {
            padding-left: 20px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.7;
            font-size: 1rem;
        }
        
        .recipe-modal-ingredients li, .recipe-modal-instructions li {
            margin-bottom: 6px;
        }

        .recipe-modal-instructions p {
            margin-bottom: 15px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.8);
        }

        .recipe-enjoy {
            font-family: 'AnalogueOS', sans-serif;
            font-size: 2.5rem;
            color: #ffffff;
            text-align: center;
            margin-top: 40px;
            opacity: 0.8;
        }
        
        @media (max-width: 1200px) {
            .main-title { font-size: 7rem; }
            .desktop-cards { grid-template-columns: repeat(2, 1fr); }
            .year-badge { top: -15px; right: -40px; font-size: 0.9rem; }
        }
        
        @media (max-width: 992px) {
            .main-title { font-size: 5.5rem; margin-top: -40px; }
            .section-title { font-size: 3.5rem; }
            .year-badge { right: -30px; top: -10px; }
        }
        
        @media (max-width: 768px) {
            .nav-indicator { top: 75%; right: 20px; }
            .cards-dots { display: flex; }
            .hero-title { display: inline-block; }
            .main-title { font-size: 4rem; margin-top: -30px; }
            .year-badge { position: absolute; top: -5px; right: -40px; left: auto; transform: rotate(10deg); font-size: 0.8rem; padding: 3px 10px; vertical-align: baseline; }
            .hero-subtitle { font-size: 1.1rem;}
            .desktop-cards { display: none; }
            .logo-fixed { width: 45px; top: 20px; left: 20px; }
            #section2 .section-content {
                display: flex;
                flex-direction: column;
                height: 100%;
                padding-top: 80px; 
                padding-bottom: 60px;
                padding-left: 20px;
                padding-right: 20px;
                overflow-x: hidden;
                width: 100%;
            }
            .categories-section { margin-top: 10px; display: block; width: 100%; overflow-x: hidden; }
            .categories-tabs { justify-content: center; gap: 8px; margin-bottom: 20px; }
            .category-tab { padding: 8px 16px; font-size: 0.85rem; margin-bottom: 5px; }
            .mobile-cards-container { 
                display: block; 
                height: 50vh; 
                width: 85%;
                margin: auto;
                overflow: hidden; 
            }
            .section-title { margin-bottom: 15px; font-size: 2.5rem; padding-left: 10px;}
            .oranges-overlay-text { font-size: 1.5rem; letter-spacing: 2px;}
        }
        
        @media (max-width: 576px) {
            .main-title { font-size: 3rem; }
            .section-title { font-size: 2.2rem; }
            .logo-fixed { width: 40px; top: 15px; left: 15px; }
            .year-badge { top: -40px; right: -25px; }
        }
    </style>
</head>
<body>
    <div id="preloader">
        <div class="loader-content">
            <img src="assets/IMG/LOGO/logo.webp" alt="Logo" class="loader-logo">
            <div class="progress-wrapper">
                <div id="loader-bar"></div>
            </div>
            <p id="loader-text">SMARMELLANDO... 0%</p>
        </div>
    </div>

    <div class="scroll-progress">
        <div class="scroll-progress-bar" id="scrollProgress"></div>
    </div>
    
    <div class="logo-fixed">
        <img src="assets/IMG/LOGO/logo.webp" alt="SMARMELLATA Logo" class="logo-img">
    </div>
    
    <div class="recipe-modal" id="recipeModal">
        <div class="recipe-modal-content">
            <div class="recipe-modal-close" id="modalClose">
                <i class="fas fa-times"></i>
            </div>
            <div class="recipe-modal-image">
                <img id="modalImage" src="" alt="">
            </div>
            <div class="recipe-modal-body">
                <h2 class="recipe-modal-title" id="modalTitle"></h2>
                
                <div class="recipe-meta">
                    <div class="meta-item">
                        <i class="fas fa-signal"></i>
                        <span class="meta-value" id="modalDifficulty"></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        <span class="meta-value" id="modalTime"></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-user-friends"></i>
                        <span class="meta-value" id="modalPortions"></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-utensils"></i>
                        <span class="meta-value" id="modalPairing"></span>
                    </div>
                </div>

                <div class="recipe-modal-ingredients">
                    <h3>Ingredienti</h3>
                    <ul id="modalIngredients"></ul>
                </div>
                <div class="recipe-modal-instructions">
                    <h3>Procedimento</h3>
                    <div id="modalInstructions"></div> </div>
            </div>
        </div>
    </div>
    
    <div class="main-container" id="mainContainer">
        <section id="section1" class="fullscreen-section">
            <div class="section-bg"></div>
            
            <div id="model-container"></div>
            
            <div class="hero-content">
                <div class="hero-title">
                    <span class="main-title">SMARMELLATA</span>
                    <span class="year-badge">2025</span>
                </div>
                <div class="hero-subtitle">
                    il regalo natalizio meno corporate di sempre
                </div>
            </div>
            
            <div class="scroll-arrow" onclick="scrollToSection(2)">
                <i class="fas fa-chevron-down"></i>
            </div>
        </section>
        
        <section id="section2" class="fullscreen-section">
            <div class="section-bg"></div>
            <div class="section-content">
                <h1 class="section-title">Le Sricette</h1>
                
                <div class="categories-section">
                    <div class="categories-tabs">
                        <div class="category-tab active" data-category="antipasti">Antipasti</div>
                        <div class="category-tab" data-category="primi">Primi</div>
                        <div class="category-tab" data-category="secondi">Secondi</div>
                        <div class="category-tab" data-category="dolci">Dolci</div>
                        <div class="category-tab" data-category="drinks">Drinks</div>
                    </div>
                    
                    <div class="desktop-cards" id="desktopCards"></div>
                    
                    <div class="mobile-cards-container" id="mobileCardsContainer">
                        <div class="mobile-nav-buttons">
                            <button class="mobile-nav-button prev-button" id="mobilePrevButton">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="mobile-nav-button next-button" id="mobileNextButton">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="cards-dots" id="cardsDots"></div>
                </div>
            </div>
            <div class="scroll-arrow" onclick="scrollToSection(3)">
                <i class="fas fa-chevron-down"></i>
            </div>
        </section>
        
        <section id="section3" class="fullscreen-section">
            <div class="oranges-overlay-text">e' natale, non il carnevale di Ivrea</div>
            
            <div id="gyro-btn" class="gyro-button" style="display:none;">
                <i class="fas fa-mobile-alt"></i> Attiva Gravità
            </div>

            <div id="oranges-canvas-container"></div>
            
            <div class="scroll-arrow" onclick="scrollToSection(1)" style="color: rgba(255,255,255,0.5);">
                <i class="fas fa-chevron-up"></i>
            </div>
        </section>
    </div>
    
    <div class="nav-indicator">
        <div class="nav-dot active" data-section="1">
            <span class="nav-label">SMARMELLATA 2025</span>
        </div>
        <div class="nav-dot" data-section="2">
            <span class="nav-label">Le Sricette</span>
        </div>
        <div class="nav-dot" data-section="3">
            <span class="nav-label">Scappano Tutti</span>
        </div>
    </div>
    
    <script>
        // ==================== MANAGER CARICAMENTO (AGGIUNTO) ====================
        const loadingManager = new THREE.LoadingManager();
        const loaderBar = document.getElementById('loader-bar');
        const loaderText = document.getElementById('loader-text');

        loadingManager.onProgress = function(url, itemsLoaded, itemsTotal) {
            const progress = (itemsLoaded / itemsTotal) * 100;
            loaderBar.style.width = progress + '%';
            loaderText.textContent = `SMARMELLANDO... ${Math.round(progress)}%`;
        };

        loadingManager.onLoad = function() {
            setTimeout(() => {
                document.getElementById('preloader').classList.add('finished');
            }, 800);
        };

        // ==================== THREE.JS: MAIN HERO (BARATTOLO) ====================
        let mainModelData = { scene: null, camera: null, renderer: null, model: null, mixer: null };
        let isMainModelInitialized = false;
        
        function initMainModel() {
            if (isMainModelInitialized) return;
            
            const container = document.getElementById('model-container');
            const isMobile = window.innerWidth < 768; 
            
            mainModelData.scene = new THREE.Scene();
            mainModelData.scene.fog = new THREE.Fog(0x0a0a0a, 10, 40);
            
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            mainModelData.camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            mainModelData.camera.position.set(0, 0.7, 5.5);
            
            mainModelData.renderer = new THREE.WebGLRenderer({ 
                alpha: true, 
                antialias: true,
                powerPreference: "high-performance"
            });
            mainModelData.renderer.setSize(width, height);
            mainModelData.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            mainModelData.renderer.physicallyCorrectLights = true; 
            mainModelData.renderer.outputEncoding = THREE.sRGBEncoding;
            mainModelData.renderer.toneMapping = THREE.ACESFilmicToneMapping;
            mainModelData.renderer.toneMappingExposure = 1;
            
            mainModelData.renderer.shadowMap.enabled = true;
            mainModelData.renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
            container.appendChild(mainModelData.renderer.domElement);
            
            const pmremGenerator = new THREE.PMREMGenerator(mainModelData.renderer);
            pmremGenerator.compileEquirectangularShader();
            const environment = new THREE.RoomEnvironment();
            mainModelData.scene.environment = pmremGenerator.fromScene(environment).texture;
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 1);
            mainModelData.scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1); 
            directionalLight.position.set(5, 5, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.bias = -0.0001;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            mainModelData.scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x88ccff, 20, 20);
            pointLight.position.set(-7, -5, 5);
            mainModelData.scene.add(pointLight);

            const loadingElement = document.createElement('div');
            loadingElement.className = 'model-loading';
            loadingElement.textContent = 'Caricamento modello...';
            container.appendChild(loadingElement);
            
            // USIAMO IL LOADING MANAGER QUI
            const loader = new THREE.GLTFLoader(loadingManager);
            loader.load(
                'assets/Smarmellata.glb?v=' + new Date().getTime(),
                function(gltf) {
                    mainModelData.model = gltf.scene;
                    mainModelData.scene.add(mainModelData.model);
                    mainModelData.model.position.set(0, 0, 0);
                    mainModelData.model.scale.set(9, 9, 9);
                    
                    mainModelData.model.traverse(function(child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            if(child.material) {
                                child.material.needsUpdate = true;
                                child.material.envMapIntensity = 1.0; 
                            }
                        }
                    });
                    
                    if (gltf.animations && gltf.animations.length) {
                        mainModelData.mixer = new THREE.AnimationMixer(mainModelData.model);
                        gltf.animations.forEach((clip) => {
                            mainModelData.mixer.clipAction(clip).play();
                        });
                    }
                    container.removeChild(loadingElement);
                },
                function(xhr) {
                    loadingElement.textContent = 'Caricamento: ' + Math.round(xhr.loaded / xhr.total * 100) + '%';
                },
                function(error) {
                    console.error('Errore modello Hero', error);
                    createFallbackModel(); 
                    container.removeChild(loadingElement);
                }
            );
            
            isMainModelInitialized = true;
            let targetRotationX = 0;
            let targetRotationZ = 0;

            if (!isMobile) {
                document.addEventListener('mousemove', function(event) {
                    if (!mainModelData.model) return;
                    const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                    const mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
                    targetRotationX = Math.PI * 0.1 + mouseY * 0.05;
                    targetRotationZ = mouseX * 0.05;
                });
            }
            
            const clock = new THREE.Clock();
            function animateMain() {
                requestAnimationFrame(animateMain);
                const delta = clock.getDelta();
                if (mainModelData.mixer) mainModelData.mixer.update(delta);
                if (mainModelData.model) {
                    mainModelData.model.rotation.y += -0.005;
                    mainModelData.model.position.y = Math.sin(clock.getElapsedTime()) * 0.1;
                    if (!isMobile) {
                        const targetX = targetRotationX !== 0 ? targetRotationX : Math.PI * 0.1;
                        mainModelData.model.rotation.x = THREE.MathUtils.lerp(mainModelData.model.rotation.x, targetX, 0.1);
                        mainModelData.model.rotation.z = THREE.MathUtils.lerp(mainModelData.model.rotation.z, targetRotationZ, 0.1);
                    } else {
                        mainModelData.model.rotation.x = THREE.MathUtils.lerp(mainModelData.model.rotation.x, Math.PI * 0.1, 0.1);
                        mainModelData.model.rotation.z = THREE.MathUtils.lerp(mainModelData.model.rotation.z, 0, 0.1);
                    }
                }
                mainModelData.renderer.render(mainModelData.scene, mainModelData.camera);
            }
            animateMain();
            
            window.addEventListener('resize', function() {
                const w = container.clientWidth;
                const h = container.clientHeight;
                mainModelData.camera.aspect = w / h;
                mainModelData.camera.updateProjectionMatrix();
                mainModelData.renderer.setSize(w, h);
            });
        }

        function createFallbackModel() {
            const geometry = new THREE.CylinderGeometry(1.5, 1.5, 3, 32);
            const material = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3, metalness: 0.2 });
            mainModelData.model = new THREE.Mesh(geometry, material);
            mainModelData.scene.add(mainModelData.model);
        }

        // ==================== THREE.JS: ORANGES SCENE ====================
        let orangesData = { scene: null, camera: null, renderer: null, oranges: [] };
        let isOrangesInitialized = false;
        let gyroEnabled = false;
        let targetGravity = { x: 0, y: 0 };
        let currentGravity = { x: 0, y: 0 };

        function initOrangesScene() {
            if (isOrangesInitialized) return;
            const container = document.getElementById('oranges-canvas-container');
            const gyroBtn = document.getElementById('gyro-btn');

            const config = {
                bgColor: 0x111111,
                count: { mobile: 35, desktop: 80 },
                mouseRadius: { mobile: 0.25, desktop: 0.25 },
                fleeForce: 0.05,
                baseGravity: 0.0015, 
                friction: 0.98,          
                gyroFriction: 0.96,      
                returnSpeed: 0.05,
                gyroSensitivity: 0.001,  
                gyroLerp: 0.1,           
                maxSpeed: 0.15           
            };

            const isMobile = window.innerWidth < 768;
            if (isMobile) {
                gyroBtn.style.display = 'flex';
                gyroBtn.onclick = function() {
                    if (!gyroEnabled) {
                        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                            DeviceOrientationEvent.requestPermission()
                                .then(response => {
                                    if (response === 'granted') toggleGyro(true);
                                })
                                .catch(console.error);
                        } else { toggleGyro(true); }
                    } else { toggleGyro(false); }
                };
            }

            function toggleGyro(active) {
                gyroEnabled = active;
                if (active) {
                    gyroBtn.classList.add('active');
                    gyroBtn.innerHTML = '<i class="fas fa-toggle-on"></i> Gravità ON';
                    window.addEventListener('deviceorientation', handleOrientation);
                } else {
                    gyroBtn.classList.remove('active');
                    gyroBtn.innerHTML = '<i class="fas fa-mobile-alt"></i> Attiva Gravità';
                    window.removeEventListener('deviceorientation', handleOrientation);
                    targetGravity = { x: 0, y: 0 };
                    currentGravity = { x: 0, y: 0 };
                }
            }

            function handleOrientation(event) {
                let x = event.gamma || 0; 
                let y = event.beta || 0;  
                if (x > 60) x = 60; if (x < -60) x = -60;
                if (y > 90) y = 90; if (y < -90) y = -90;
                targetGravity.x = x * config.gyroSensitivity; 
                targetGravity.y = -(y - 45) * config.gyroSensitivity; 
            }
            
            orangesData.scene = new THREE.Scene();
            orangesData.scene.background = new THREE.Color(config.bgColor);
            let aspect = container.clientWidth / container.clientHeight;
            const viewSize = 2;
            orangesData.camera = new THREE.OrthographicCamera(-viewSize * aspect, viewSize * aspect, viewSize, -viewSize, 0.1, 1000);
            orangesData.camera.position.z = 10;
            
            orangesData.renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
            orangesData.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            orangesData.renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(orangesData.renderer.domElement);
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            orangesData.scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
            dirLight.position.set(5, 10, 7);
            orangesData.scene.add(dirLight);
            
            // USIAMO IL LOADING MANAGER QUI
            const loader = new THREE.GLTFLoader(loadingManager);
            loader.load('assets/Arancia.glb', function (gltf) {
                const model = gltf.scene;
                const box = new THREE.Box3().setFromObject(model);
                const size = box.getSize(new THREE.Vector3());
                const scaleFactor = 2 / Math.max(size.x, size.y, size.z);
                const center = box.getCenter(new THREE.Vector3());
                model.position.sub(center);
                const wrapper = new THREE.Group();
                model.scale.set(scaleFactor, scaleFactor, scaleFactor);
                wrapper.add(model);
                spawnOranges(wrapper);
            }, undefined, function (error) {
                const geometry = new THREE.SphereGeometry(0.5, 32, 32);
                const material = new THREE.MeshStandardMaterial({ color: 0xffa500, roughness: 0.5 });
                spawnOranges(new THREE.Mesh(geometry, material));
            });
            
            function spawnOranges(masterModel) {
                const count = isMobile ? config.count.mobile : config.count.desktop;
                const limitX = viewSize * aspect;
                const limitY = viewSize;
                for (let i = 0; i < count; i++) {
                    const orange = masterModel.clone();
                    const baseScale = 0.20 + Math.random() * 0.15;
                    orange.scale.set(baseScale, baseScale, baseScale);
                    let x = (Math.random() - 0.5) * 2 * limitX;
                    let y = (Math.random() - 0.5) * 2 * limitY;
                    orange.position.set(x, y, (Math.random() - 0.5) * 0.5);
                    orange.userData = {
                        velocity: new THREE.Vector3(0, 0, 0),
                        baseScale: new THREE.Vector3(baseScale, baseScale, baseScale),
                        rotSpeed: new THREE.Vector3((Math.random()-0.5)*0.02, (Math.random()-0.5)*0.02, 0),
                        radius: baseScale * 0.5
                    };
                    orangesData.scene.add(orange);
                    orangesData.oranges.push(orange);
                }
            }
            
            const mouse = new THREE.Vector2(-1000, -1000);
            const mouse3D = new THREE.Vector3();
            const raycaster = new THREE.Raycaster();
            const plane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0);

            function updateMouse(clientX, clientY) {
                const rect = container.getBoundingClientRect();
                mouse.x = ((clientX - rect.left) / container.clientWidth) * 2 - 1;
                mouse.y = -((clientY - rect.top) / container.clientHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, orangesData.camera);
                raycaster.ray.intersectPlane(plane, mouse3D);
            }
            
            document.addEventListener('mousemove', e => updateMouse(e.clientX, e.clientY));
            
            function animateOranges() {
                requestAnimationFrame(animateOranges);
                const currentLimitX = viewSize * (container.clientWidth / container.clientHeight);
                const currentLimitY = viewSize;
                if (gyroEnabled) {
                    currentGravity.x += (targetGravity.x - currentGravity.x) * config.gyroLerp;
                    currentGravity.y += (targetGravity.y - currentGravity.y) * config.gyroLerp;
                }
                orangesData.oranges.forEach(orange => {
                    const data = orange.userData;
                    if (gyroEnabled) {
                        data.velocity.x += currentGravity.x;
                        data.velocity.y += currentGravity.y;
                    } else { data.velocity.y -= config.baseGravity; }
                    const dx = orange.position.x - mouse3D.x;
                    const dy = orange.position.y - mouse3D.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < config.mouseRadius.desktop * 2) {
                        const force = (1 - dist / (config.mouseRadius.desktop * 2)) * config.fleeForce;
                        const angle = Math.atan2(dy, dx);
                        data.velocity.x += Math.cos(angle) * force;
                        data.velocity.y += Math.sin(angle) * force;
                    }
                    data.velocity.multiplyScalar(gyroEnabled ? config.gyroFriction : config.friction);
                    orange.position.add(data.velocity);
                    if(orange.position.x > currentLimitX-data.radius) { orange.position.x = currentLimitX-data.radius; data.velocity.x *= -0.6; }
                    else if(orange.position.x < -currentLimitX+data.radius) { orange.position.x = -currentLimitX+data.radius; data.velocity.x *= -0.6; }
                    if(orange.position.y > currentLimitY-data.radius) { orange.position.y = currentLimitY-data.radius; data.velocity.y *= -0.6; }
                    else if(orange.position.y < -currentLimitY+data.radius) { orange.position.y = -currentLimitY+data.radius; data.velocity.y *= -0.6; }
                    orange.rotation.x += data.rotSpeed.x; orange.rotation.y += data.rotSpeed.y;
                });
                orangesData.renderer.render(orangesData.scene, orangesData.camera);
            }
            animateOranges();
            isOrangesInitialized = true;
        }
        
        // ==================== TUOI DATI E LOGICA CARDS (INVARIATI) ====================
        const cardsData = {
            antipasti: [
                { id: 1, title: "Stagliere", ingredients: ["Camembert","Brie","Asiago pressato","Fontina","Parmigiano Reggiano 12 mesi","Raquefort","Pecorino romano","Smarmellata"], instructions: ["Porzionare i formaggi su un tagliere e accompagnare con generosa Smarmellata."], difficulty: "Facile", time: "5 min", pairing: "Spritz Campari, Vino Prosecco superiore, Sidro di mele o Birra Farmhouse ALE", portions: "QB" },
                { id: 2, title: "Sgamberetti", ingredients: ["20 gamberi", "100 g di farina di riso", "100 g di farina di cocco", "2 uova", "Sale", "Olio di arachidi","150 g di Smarmellata","2 cucchiai di senape"], instructions: ["Iniziate dalla salsa: in una ciotolina mescolate la Smarmellata, la senape e il sale con un cucchiaio o una frusta a mano fino a ottenere una salsa omogenea. Lasciate riposare in frigorifero.","Pulite i gamberi privandoli del carapace e della testa, ma conservando la coda. Con uno stecchino di legno sfilate il filo intestinale, sciacquate e asciugate.","In un piatto sbattete le uova con il sale e disponete le due farine in altri due piatti separati. Passate i gamberi prima nella farina di riso, poi nell'uovo sbattuto e poi nella farina di cocco. Friggeteli, pochi alla volta, in abbondante olio a 170° per circa 1 minuto o comunque fino a doratura.", "Scolateli con un mestolo forato e lasciateli asciugare sulla carta per fritti. Trasferite i gamberi fritti al cocco sul piatto da portata, guarniteli con sale e serviteli con la salsa alla Smarmellata."], difficulty: "Media", time: "30 min", pairing: "Vino Franciacorta Satèn", portions: "4 persone" },
                { id: 3, title: "Stortino", ingredients: ["200 g di farina", "100 g di burro", "70 ml di acqua ghiacciata","300 g di Gorgonzola dolce","4 cucchiai di Smarmellata","Un sedano intero"], instructions: ["Frullate il burro freddo con la farina per pochi minuti e mettete il tutto in una capiente ciotola e aggiungete l’acqua.", "Impastate a mano fino a che la pasta non risulti morbida. Tagliate a pezzettini piccolissimi un gambetto di sedano e mischiatelo alla pasta, formate una palla e mettete in frigo avvolta dalla pellicola per almeno 40 minuti.","Stendete la pasta sottilmente (circa 1/2 centimetro) e tagliate dei dischi poco più grandi dello stampino che userete per la cottura. Ritagliate anche un disco più piccolo che servirà per chiudere la tortina.","Rivestite lo stampino di carta forno e ricoprite con la pasta, aggiungete 3 o 4 cubetti di gorgonzola e chiudete con il disco più piccolo.","Rimettete in frigo per circa 10 munti poi infornate a 200° per 15/20 minuti. Trascorso tale tempo togliete dal forno e spalmate uno strato leggero di Smarmellata sulla tortina, e infornate nuovamente per altri 5/10 minuti in base al vostro forno e alla cottura della brisè.","Togliete dal forno e mettete al centro del tortino caldo due cucchiaini abbondanti di Smarmellata e decorate il piatto con la stessa."], difficulty: "Difficile", time: "60 min", pairing: "Birra Imperial Stout", portions: "4 persone" }
            ],
            primi: [
                { id: 4, title: "Srisotto", ingredients: ["360 g di riso carnaroli", "6 gamberi", "⅓ di porro","2 cucchiaini di Smarmellata","Olio per friggere il porro","70 g di burro gelato","Pepe nero","Vino bianco","Un gambo di sedano","Una carota","Una cipolla","Chiodi di garofano"], instructions: ["Pulite i gamberi privandoli del carapace della coda e della testa, conservate le teste. Con uno stecchino di legno sfilate il filo intestinale, sciacquate e asciugate.", "Realizzare il brodo di pesce: infilate i chiodi di garofano nella cipolla e mettete a scaldare in abbondante acqua con il sedano, la carota e le teste dei gamberi.","Tostare il riso in un tegame insieme alla metà del porro. Sfumare con il vino bianco. Aggiungete a poco a poco il brodo di pesce filtrato.","Nel frattempo cuocere i gamberi a vapore e tagliarli a pezzetti. Friggere il porro rimasto rendendolo croccante nell’olio. Continuare a mescolare il riso e portarlo a cottura.","Togliere il tegame dal fuoco e aggiungere il burro gelato, il pepe nero macinato, due cucchiaini abbondanti di Smarmellata e mantecare.", "Impiattare il risotto e decorarlo con i gamberi, il porro croccante e la Smarmellata."], difficulty: "Media", time: "45 min", pairing: "Vino Champagne Blanc de Blancs", portions: "4 persone" },
                { id: 5, title: "Stofu", ingredients: ["400 g di tofu compatto","3 cucchiai di salsa di soia", "2 cucchiai di sciroppo d’acero", "4 cucchiai di Smarmellata","1 cucchiaio della vostra salsa piccante preferita","Il succo di una arancia","Scorza di arancia","Semi di sesamo","3 peperoni verdi"], instructions: ["Iniziate dalla salsa: mescolate in una ciotola: la salsa di soia, la Smarmellata, lo sciroppo d’acero, il succo di arancia e la salsa piccante.", "Nel frattempo tagliate a dadi il tofu e rosolatelo in una padella con un filo d’olio fino a farlo dorare da tutti i lati. Una volta divenuto croccante e dorato, unite la salsa precedentemente preparata al tofu e lasciate cuocere in padella mescolando accuratamente","Unite i peperoni tagliati a striscioline o fettine sottilissime e fate cuocere per qualche minuto a fuoco dolce fino a raggiunere la consistenza desiderata ed impiattare guarnendo con scorza di arancia grattuggiata."], difficulty: "Facile", time: "20 min", pairing: "Vino Orange Wines", portions: "4 persone" },
                { id: 6, title: "Scaprese", ingredients: ["2 mozzarelle di bufala", "2 cucchiai di Smarmellata", "Basilico fresco"], instructions: ["Tagliare la mozzarella di bufala in spicchi e disporre su un piatto. Con un cucchiaio porzionare la Smarmellata tra gli spicchi di mozzarella di bufala. Lavare bene le foglie di basilico, aggiungere a piacere sul piatto e guarnire con olio EVO"], difficulty: "Facile", time: "5 min", pairing: "Vino Fiano di Avellino", portions: "2 persone" }
            ],
            secondi: [
                { id: 7, title: "Sanatra", ingredients: ["Petto d’anatra (2 da 800 g)", "Bacche di ginepro", "Rosmarino","Olio EVO","60 g di Smarmellata","600 g di patate novelle","Aglio","Sale"], instructions: ["Eliminate le piccole piume rimaste attaccate alla pelle dei petti d'anatra con una pinzetta da cucina. Incidete i petti dalla parte della pelle praticando 3 tagli in diagonale e 4 trasversali per creare dei rombi.","Ponete i petti dalla parte incisa in una padella antiaderente ben calda e lasciate cuocere 3 minuti in modo che si crei una crosticina dorata; poi girateli e lasciateli dorare anche sull’altro lato per altri 3 minuti.","Mettete la Smarmellata in una ciotolina e poi spennellate la pelle dei petti, coprendoli in maniera uniforme. Versate circa un quarto di bicchiere d’acqua sul fondo della teglia. Coprite con un foglio di alluminio e cuocete a 160° per 30-40 minuti."], difficulty: "Difficile", time: "90 min", pairing: "Vino Pinot Nero o Vino Gewürztraminer", portions: "4 persone" },
                { id: 8, title: "Ssalmone", ingredients: ["2 porzioni di salmone norvegese da 150 g", "2 cucchiai di Smarmellata", "Olio EVO","Succo di una arancia","2 cucchiai di salsa di soia","2 cucchiai di zucchero di canna","Paprika","Pepe nero"], instructions: ["In un recipiente creare una marinatura con l’olio extravergine d’oliva, lo zucchero di canna, la salsa di soia, il succo di arancia. Marinare per 10 min.","Sistemarle su una teglia con la pelle rivolta verso il basso. Infornare a 180° per 8/10 minuti.","Spennellare il salmone con una glassa di Smarmellata ed acqua. Infornare nuovamente per altri 2/3 minuti."], difficulty: "Facile", time: "50 min", pairing: "Vino Riesling", portions: "2 persone" },
                { id: 9, title: "Scostine", ingredients: ["2 Kg di costine di maiale singole", "200 g di Smarmellata", "2 bicchieri di salsa di soia","Sale","Pepe nero","Vino bianco","Aglio","Salsa piccante"], instructions: ["Rosolare le costine in padella. Sciacquare con acqua bollente per eliminare il grasso.","Disporre le costine in un tegame con acqua, vino, soia, Smarmellata e aglio.","Stufare per 30-40 minuti fino ad addensare il sugo."], difficulty: "Media", time: "90 min", pairing: "Vino Primitivo di Manduria", portions: "4 persone" }
            ],
            dolci: [
                { id: 13, title: "Scrostata", ingredients: ["150 g di mascarpone", "Smarmellata!", "2 Uova","80 g di zucchero","200 g di farina 00","100 g di burro"], instructions: ["Preparare la frolla e lasciarla raffreddare in frigo 30 min.","Mescolare mascarpone, uova e zucchero.","Versare la crema sulla base, aggiungere Smarmellata e infornare a 180° per 30 minuti."], difficulty: "Difficile", time: "90 min", pairing: "Vin Santo del Chianti", portions: "8 persone" },
                { id: 14, title: "Smarmellamisu", ingredients: ["3/4 biscotti alla farina di segale", "125 g di Yogurt al caffè", "20 g di Smarmellata","1 tazzina di caffè"], instructions: ["Inzuppare i biscotti nel caffè.","Alternare strati di biscotti e yogurt, finire con Smarmellata.","Lasciar riposare in frigo una notte."], difficulty: "Facile", time: "15 min", pairing: "Passito di pantelleria o Birra Coffee Stout", portions: "Per porzione" },
                { id: 15, title: "Sricotta", ingredients: ["2 fette di ricotta", "Smarmellata", "Pistacchi"], instructions: ["Piastrare la ricotta calda da entrambi i lati.","Mettere Smarmellata sopra e far raffreddare in frigo 1 ora.","Decorare con pistacchi."], difficulty: "Facile", time: "5 min", pairing: "Vino Sauvignon Blanc", portions: "2 persone" }
            ],
            drinks: [
                { id: 10, title: "Scoffee", ingredients: ["Miscela per caffè americano", "Cannella", "Smarmellata"], instructions: ["Aggiungere cannella al caffè e Smarmellata nella caffettiera vuota.","Estrarre il caffè e mescolare."], difficulty: "Facile", time: "5 min", pairing: "Cioccolato fondente", portions: "4 persone" },
                { id: 11, title: "Smargarita", ingredients: ["Tequila", "Triple sec", "Smarmellata", "Succo pompelmo"], instructions: ["Shakerare tutti gli ingredienti con ghiaccio.","Filtrare nel bicchiere con bordo di sale."], difficulty: "Facile", time: "5 min", pairing: "-", portions: "1 persona" },
                { id: 12, title: "Lady Smarmalade", ingredients: ["Gin", "Bitter", "Acqua tonica", "Smarmellata"], instructions: ["Mescolare Smarmellata, Gin e Bitter nel bicchiere con ghiaccio.","Colmare con tonica."], difficulty: "Facile", time: "5 min", pairing: "-", portions: "1 persona" }
            ]
        };

        function getImagePath(category, index) {
            let prefix = '';
            switch(category) {
                case 'antipasti': prefix = 'Antipasto'; break;
                case 'primi': prefix = 'Primo'; break;
                case 'secondi': prefix = 'Secondo'; break;
                case 'dolci': prefix = 'Dolce'; break;
                case 'drinks': prefix = 'Drink'; break;
                default: prefix = 'Antipasto';
            }
            return `assets/IMG/RICETTE/${prefix} ${(index + 1).toString().padStart(2, '0')}.webp`;
        }

        let currentCategory = 'antipasti';
        let currentMobileCardIndex = 0;
        let totalCards = 0;

        function initCardsSystem() {
            const desktopCards = document.getElementById('desktopCards');
            const mobileCardsContainer = document.getElementById('mobileCardsContainer');
            const cardsDots = document.getElementById('cardsDots');
            const categoryTabs = document.querySelectorAll('.category-tab');

            function generateCards(cat) {
                const list = cardsData[cat];
                totalCards = list.length;
                desktopCards.innerHTML = '';
                mobileCardsContainer.innerHTML = `
                    <div class="mobile-nav-buttons">
                        <button class="mobile-nav-button prev-button" id="mobilePrevButton"><i class="fas fa-chevron-left"></i></button>
                        <button class="mobile-nav-button next-button" id="mobileNextButton"><i class="fas fa-chevron-right"></i></button>
                    </div>`;
                cardsDots.innerHTML = '';
                currentMobileCardIndex = 0;

                list.forEach((card, idx) => {
                    const img = getImagePath(cat, idx);
                    const dCard = document.createElement('div');
                    dCard.className = 'desktop-card';
                    dCard.style.animationDelay = `${idx * 0.15}s`;
                    dCard.innerHTML = `<div class="card-image"><img src="${img}" onerror="this.src='https://via.placeholder.com/400x600/222/fff?text=${card.title}'"></div><div class="card-content"><h3 class="card-title">${card.title}</h3></div>`;
                    dCard.onclick = () => openRecipeModal(cat, idx);
                    desktopCards.appendChild(dCard);

                    const mCard = document.createElement('div');
                    mCard.className = `mobile-card ${idx===0?'active entrance-anim':(idx===1?'next':'previous')}`;
                    mCard.innerHTML = `<div class="card-image"><img src="${img}" onerror="this.src='https://via.placeholder.com/400x600/222/fff?text=${card.title}'"></div><div class="card-content"><h3 class="card-title">${card.title}</h3></div>`;
                    mCard.onclick = () => openRecipeModal(cat, idx);
                    mobileCardsContainer.appendChild(mCard);

                    const dot = document.createElement('div');
                    dot.className = `card-dot ${idx===0?'active':''}`;
                    dot.onclick = () => updateMobileView(idx);
                    cardsDots.appendChild(dot);
                });
                bindMobileEvents();
            }

            function bindMobileEvents() {
                document.getElementById('mobilePrevButton').onclick = () => {
                    let newIndex = currentMobileCardIndex - 1;
                    if (newIndex < 0) newIndex = totalCards - 1; 
                    updateMobileView(newIndex);
                };
                document.getElementById('mobileNextButton').onclick = () => {
                    let newIndex = currentMobileCardIndex + 1;
                    if (newIndex >= totalCards) newIndex = 0; 
                    updateMobileView(newIndex);
                };
            }

            function updateMobileView(index) {
                currentMobileCardIndex = index;
                const mCards = document.querySelectorAll('.mobile-card');
                mCards.forEach((c, i) => {
                    c.classList.remove('entrance-anim'); 
                    c.className = `mobile-card ${i===index?'active':(i<index?'previous':'next')}`;
                });
                const dots = document.querySelectorAll('.card-dot');
                dots.forEach((d, i) => d.classList.toggle('active', i===index));
            }

            categoryTabs.forEach(tab => {
                tab.onclick = function() {
                    categoryTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    generateCards(currentCategory);
                }
            });
            generateCards(currentCategory);
        }

        function openRecipeModal(cat, idx) {
            const data = cardsData[cat][idx];
            const modal = document.getElementById('recipeModal');
            document.getElementById('modalTitle').textContent = data.title;
            document.getElementById('modalImage').src = getImagePath(cat, idx);
            document.getElementById('modalDifficulty').textContent = data.difficulty;
            document.getElementById('modalTime').textContent = data.time;
            document.getElementById('modalPortions').textContent = data.portions;
            document.getElementById('modalPairing').textContent = data.pairing;

            const ingList = document.getElementById('modalIngredients');
            ingList.innerHTML = '';
            data.ingredients.forEach(ing => {
                const li = document.createElement('li'); li.textContent = ing; ingList.appendChild(li);
            });
            const insList = document.getElementById('modalInstructions');
            insList.innerHTML = '';
            data.instructions.forEach(ins => {
                const p = document.createElement('p'); p.textContent = ins; insList.appendChild(p);
            });
            const enjoyDiv = document.createElement('div');
            enjoyDiv.className = 'recipe-enjoy'; enjoyDiv.textContent = 'Enjoy!';
            insList.appendChild(enjoyDiv);
            modal.classList.add('active');
        }

        document.getElementById('modalClose').onclick = () => document.getElementById('recipeModal').classList.remove('active');

        // ==================== NAVIGAZIONE E INIZIALIZZAZIONE ====================
        document.addEventListener('DOMContentLoaded', function() {
            // FORZIAMO L'INIZIALIZZAZIONE IMMEDIATA PER IL LOADER
            initMainModel();
            initOrangesScene();
            initCardsSystem();

            const sections = document.querySelectorAll('.fullscreen-section');
            const navDots = document.querySelectorAll('.nav-dot');
            const mainContainer = document.getElementById('mainContainer');
            const scrollProgress = document.getElementById('scrollProgress');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
                        const id = entry.target.id;
                        const num = id.replace('section', '');
                        navDots.forEach(d => d.classList.toggle('active', d.dataset.section === num));
                        const content = entry.target.querySelector('.section-content');
                        if(content) content.classList.add('visible');
                    }
                });
            }, { threshold: 0.5 });

            sections.forEach(s => observer.observe(s));

            mainContainer.addEventListener('scroll', () => {
                const h = mainContainer.scrollHeight - mainContainer.clientHeight;
                const w = (mainContainer.scrollTop / h) * 100;
                scrollProgress.style.width = w + '%';
            });

            navDots.forEach(dot => {
                dot.onclick = function() { scrollToSection(this.dataset.section); }
            });
        });

        function scrollToSection(num) {
            document.getElementById(`section${num}`).scrollIntoView({behavior: 'smooth'});
        }
    </script>
</body>
</html>